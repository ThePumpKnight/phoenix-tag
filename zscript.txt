version "4.12.2"

class ProsperityPower : Powerup
{
	Default
	{
	Inventory.Icon "PRSRC0";
	}
	
	override void InitEffect()
	{
		Super.InitEffect();
		if (owner && owner.player)
		{
			PlayerPawn(owner).bonushealth += 50;
			let arm = BasicArmor(owner.FindInventory('BasicArmor'));
			if (arm)
			{
			arm.bonuscount += 50;
			}
		}
	}
	override void EndEffect()
	{
		if (owner && owner.player)
	{
		PlayerPawn(owner).bonushealth -= 50;
		let arm = BasicArmor(owner.FindInventory('BasicArmor'));
		if (arm)
		{
		arm.bonuscount -= 50;
		}
	}
		Super.EndEffect();
	}
}

class ProsperityRune : PowerupGiver
{
	Default{
	+COUNTITEM;
	+NOGRAVITY;
	+FLOATBOB;
	+INVENTORY.AUTOACTIVATE;
	Inventory.MaxAmount 1;
	Inventory.Icon "PRSRC0";
	Inventory.PickupMessage "You got the Prosperity rune!";
	Inventory.PickupAnnouncerEntry "prosperity";
	Powerup.Duration 0x7FFFFFFD;
	Powerup.Type "ProsperityPower";
	}
	States{
	Spawn:
		PRSR ABCD 6;
		Loop;
	}
	
	// dedicated function that adds a value to health and armor maximums:
	void ModifyOwnerHealthArmor(int value)
	{
		if (!owner || !owner.player) return;
		PlayerPawn(owner).bonushealth += value;
		let arm = BasicArmor(owner.FindInventory('BasicArmor'));
		if (arm)
		{
			arm.bonuscount += value;
		}
	}

	// Destroy when changing levels:
	override void Travelled()
	{
		self.Destroy();
		ModifyOwnerHealthArmor(-50);
	}

	// Destroy when owner dies:
	override void OwnerDied()
	{
		self.Destroy();
		ModifyOwnerHealthArmor(-50);
	}

	// Increase counts when this item is given:
	override void AttachToOwner(Actor other)
	{
		Super.AttachToOwner(other);
		ModifyOwnerHealthArmor(50);
	}

	// Decrease counts when this item is removed:
	override void DetachFromOwner()
	{
		ModifyOwnerHealthArmor(-50);
		Super.DetachFromOwner();
	}
}

class SpreadPower : Powerup
{
	Default
	{
	Inventory.Icon "SPRRA0";
	}
}

class SpreadRune : PowerupGiver
{
	Default{
	+COUNTITEM;
	+NOGRAVITY;
	+FLOATBOB;
	+INVENTORY.AUTOACTIVATE;
	Inventory.MaxAmount 0;
	Powerup.Duration 0x7FFFFFFD;
	Powerup.Type "SpreadPower";
	Inventory.PickupMessage "You got the Spread rune!";
	Inventory.PickupAnnouncerEntry "SpreadPower";
	}
	States{
	Spawn:
		SPRR ABCD 6;
		Loop;
	}
}